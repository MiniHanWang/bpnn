# Back-Propagation Neural Networks
#mini(Wang Han)

import math
import random
import pandas as pd
#import string
try:
    import cPickle as pickle
except:
    import pickle

random.seed(0)

# calculate a random number where:  a <= rand < b
def rand(a, b):
    return (b-a)*random.random() + a

# our sigmoid function, tanh is a little nicer than the standard 1/(1+e^-x)
def sigmoid(x):
    return math.tanh(x)

# derivative of our sigmoid function, in terms of the output (i.e. y)
def dsigmoid(y):
    return 1.0 - y**2

class Unit:
    def __init__(self, length):
        self.weight = [rand(-0.2, 0.2) for i in range(length)]
        self.change = [0.0] * length
        self.threshold = rand(-0.2, 0.2)
        #self.change_threshold = 0.0
    def calc(self, sample):
        self.sample = sample[:]
        partsum = sum([i * j for i, j in zip(self.sample, self.weight)]) - self.threshold
        self.output = sigmoid(partsum)
        return self.output
    def update(self, diff, rate=0.5, factor=0.1):
        change = [rate * x * diff + factor * c for x, c in zip(self.sample, self.change)]
        self.weight = [w + c for w, c in zip(self.weight, change)]
        self.change = [x * diff for x in self.sample]
        #self.threshold = rateN * factor + rateM * self.change_threshold + self.threshold
        #self.change_threshold = factor
    def get_weight(self):
        return self.weight[:]
    def set_weight(self, weight):
        self.weight = weight[:]


class Layer:
    def __init__(self, input_length, output_length):
        self.units = [Unit(input_length) for i in range(output_length)]
        self.output = [0.0] * output_length
        self.ilen = input_length
    def calc(self, sample):
        self.output = [unit.calc(sample) for unit in self.units]
        return self.output[:]
    def update(self, diffs, rate=0.5, factor=0.1):
        for diff, unit in zip(diffs, self.units):
            unit.update(diff, rate, factor)
    def get_error(self, deltas):
        def _error(deltas, j):
            return sum([delta * unit.weight[j] for delta, unit in zip(deltas, self.units)])
        return [_error(deltas, j) for j  in range(self.ilen)]
    def get_weights(self):
        weights = {}
        for key, unit in enumerate(self.units):
            weights[key] = unit.get_weight()
        return weights
    def set_weights(self, weights):
        for key, unit in enumerate(self.units):
            unit.set_weight(weights[key])



class BPNNet:
    def __init__(self, ni, nh, no):
        # number of input, hidden, and output nodes
        self.ni = ni + 1 # +1 for bias node
        self.nh = nh
        self.no = no
        self.hlayer = Layer(self.ni, self.nh)
        self.olayer = Layer(self.nh, self.no)

    def calc(self, inputs):
        if len(inputs) != self.ni-1:
            raise ValueError('wrong number of inputs')

        # input activations
        self.ai = inputs[:] + [1.0]

        # hidden activations
        self.ah = self.hlayer.calc(self.ai)
        # output activations
        self.ao = self.olayer.calc(self.ah)


        return self.ao[:]


    def update(self, targets, rate, factor):
        if len(targets) != self.no:
            raise ValueError('wrong number of target values')

        # calculate error terms for output
        output_deltas = [dsigmoid(ao) * (target - ao) for target, ao in zip(targets, self.ao)]

        # calculate error terms for hidden
        hidden_deltas = [dsigmoid(ah) * error for ah, error in zip(self.ah, self.olayer.get_error(output_deltas))]

        # update output weights
        self.olayer.update(output_deltas, rate, factor)

        # update input weights
        self.hlayer.update(hidden_deltas, rate, factor)
        # calculate error
        return sum([0.5 * (t-o)**2 for t, o in zip(targets, self.ao)])


    def test(self, patterns):
        for p in patterns:
            print(p[1], '->', self.calc(p[0]))

    def train(self, patterns, iterations=1000, N=0.5, M=0.1):
        # N: learning rate
        # M: momentum factor
        for i in range(iterations):
            error = 0.0
            for p in patterns:
                inputs = p[0]
                targets = p[1]
                self.calc(inputs)
                error = error + self.update(targets, N, M)
            if i % 100 == 0:
                print('error %-.10f' % error)
            #self.save_weights('tmp.weights')
    def save_weights(self, fn):
        weights = {
                "olayer":self.olayer.get_weights(),
                "hlayer":self.hlayer.get_weights()
                }
        with open(fn, "wb") as f:
            pickle.dump(weights, f)
        print(weights)
    def load_weights(self, fn):
            with open(fn, "rb") as f:
                weights = pickle.load(f)
                self.olayer.set_weights(weights["olayer"])
                self.hlayer.set_weights(weights["hlayer"])
def demo_excel(filepath):
    data=pd.read_excel(filepath,encoding="utf-8",usecols = [0, 1, 2])
    result = pd.read_excel(filepath, encoding="utf-8", usecols=[3])
    pat=data.values.tolist()
    result = result.values.tolist()
    train=[]
    for i in range(0,len(pat)):
        pat_ = []
        pat_.append(pat[i])
        pat_.append(result[i])
        train.append(pat_)
    #print(train)
    # create a network with two input, two hidden, and one output nodes
    n = BPNNet(3, 16, 1)
    # train it with some patterns
    n.train(train)
    # test it
    n.save_weights("excel.weights")

    n.test(train)
def demo():
    # Teach network XOR function
    pat = [
        [[-0.181697898, -1.227434631, 0.834371331, 1.515078013, 0.856311828, 2.131455828, 1.98790397, 0.574355091,
          0.9485766, 0.02009298, 1.356685382, 0.711121419, 2.70937006, -0.979583447, -0.306074095, 0.703274857,
          2.554515383, -1.665096991, 2.776985945, 2.121320344, -0.681091406, 2.249304372, 3.055520724, 2.438077177, ],
         [0.990091981, ]],
        [[-0.151693765, -0.279731247, 0.834790023, 1.609929365, 1.01316252, 2.563729007, 1.98790397, 0.582920053,
          0.9485766, 0.032266412, 1.409823638, 0.715254228, 2.978497009, -0.97947641, -0.30583164, 0.544392425,
          2.800643561, -1.657508688, 3.339326837, 2.121320344, -0.698300639, 2.249304372, 3.055520724, 2.803255727, ],
         [1.108831856, ]],
        [[-0.135834915, -0.327118901, 0.834999902, 1.680269183, 1.048019242, 2.723344, 1.547629936, 0.592137879,
          0.9485766, 0.047036394, 1.510211514, 0.721331887, 2.6964186, -0.510359474, -0.305641772, 0.416780632,
          3.033667025, -1.670416842, 3.339326837, 2.121320344, -0.642700044, 2.249304372, 3.055520724, 2.674157709, ],
         [1.086726307, ]],
        [[2.785853514, -2.405858004, 0.834999902, 1.91289956, -0.520601656, -0.689825972, -0.653740232, 3.114165673,
          0.9485766, -1.125558541, -0.851159245, 3.023858052, -0.668004437, -1.232565679, -0.313568492, -1.158007432,
          -0.686700742, -0.94174577, -0.313997529, -0.101015254, -0.971232679, -0.048199379, -0.482450641,
          -0.683250776, ], [0.359510703, ]],
        [[3.277002509, 1.288707251, 0.834999902, 2.807808006, -0.520629483, -0.688498726, -0.653740232, 3.062573513,
          0.9485766, -1.128964404, -0.835699821, 2.9880208, -0.678319428, -1.232565679, -0.313445184, -1.160181326,
          -0.685654448, -0.94712164, -0.313310783, -0.101015254, -0.970374214, -0.048199379, -0.482450641,
          -0.681718953, ], [0.423554174, ]],
        [[3.377702458, 0.213089628, 0.699355061, 2.807808006, -0.306103874, -0.692516917, -0.653740232, 2.873402263,
          0.9485766, -1.12697484, -0.82867281, 2.924682934, -0.667965997, -1.232565679, -0.313042462, -1.164644081,
          -0.684922044, -0.955643265, -0.312473107, -0.101015254, -0.970933215, -0.048199379, -0.482450641,
          -0.681543859, ], [0.405842867, ]],
        [[-0.303560011, 0.061436517, 0.76116156, -0.285702308, -0.429278737, 0.63960957, 0.667081869, -0.324563528,
          0.087201114, 1.35027654, 0.056857035, -0.407332347, 0.957832378, 1.911275081, 2.86910482, 1.670428024,
          -0.145923342, -0.334064351, -0.319312353, 1.565736444, 1.000222668, 1.895842257, 0.107211253, -0.136759746, ],
         [0.563741059, ]],
        [[-0.297489902, 0.272217333, 0.768281813, -0.200666373, -0.422968025, 0.752093491, 0.667081869, -0.230725988,
          0.092144445, 1.441837951, 0.3011862, -0.407838832, 1.10128793, 1.902685352, 3.194440326, 1.589513159,
          -0.095702056, -0.387853503, -0.318410856, 1.565736444, 1.384775148, 1.895842257, 0.107211253, -0.081591239, ],
         [0.634079004, ]],
        [[-0.293339982, -0.467668109, 0.771599114, -0.183876901, -0.42300546, 0.852277473, 0.667081869, -0.221267426,
          0.106974439, 1.561836298, 0.268412222, -0.42024773, 1.173455585, 1.902685352, 3.402441716, 2.105269654,
          -0.099006356, -0.521952768, -0.256015314, 1.565736444, 2.478659455, 1.895842257, 0.107211253, -0.051926877, ],
         [0.761315161, ]],
        [[-0.278714812, 1.127963402, 0.836029134, -0.479239116, -0.459825195, 1.134150811, 1.547629936, -0.221287947,
          0.9485766, 1.866527874, 1.773907121, -0.524597073, -0.077894514, 0.971061022, -0.316923214, 1.736972192,
          0.97305359, -0.387422694, -0.308384535, 1.010152545, 1.923052792, -0.048199379, 0.107211253, 1.12544302, ],
         [0.356620879, ]],
        [[-0.269151803, 1.294091053, 0.836422566, -0.409893477, -0.445246208, 1.28829196, 1.98790397, -0.182311412,
          0.932510774, 1.918399848, 2.19183156, -0.525068616, 0.007595145, 0.965040184, -0.316919469, 1.562391733,
          1.022409836, -0.420075712, -0.312347075, 1.010152545, 2.558097432, -0.048199379, 0.107211253, 1.319137562, ],
         [0.462163959, ]],
        [[-0.26395772, -0.036630574, 0.836749532, -0.406593644, -0.425825785, 1.372740681, 2.428178003, -0.137748203,
          0.93312869, 2.279126982, 2.992924844, -0.51378173, 0.038663634, 0.965040184, -0.316918415, 1.874188838,
          1.036308988, -0.662238848, -0.275623572, 1.010152545, 1.188545975, -0.048199379, 0.107211253, 1.619359491, ],
         [0.467779728, ]],
        [[-0.309279192, 0.585105914, 0.545950416, -0.446083533, -0.50326874, -0.573651369, -0.653740232, -0.452403772,
          0.256510212, -0.908293455, -0.839396029, -0.518690561, -0.379921954, 0.275694374, -0.317035219, -0.885371785,
          -0.503401919, 0.019431446, -0.319530781, -0.656599154, -0.655836558, -0.578392553, 0.107211253,
          -0.573328541, ], [-0.000955047, ]],
        [[-0.293330497, 3.149646125, 0.712704023, -0.479355838, -0.502291814, -0.550078806, -0.653740232, -0.44834969,
          0.291731448, -0.898820771, -0.749239481, -0.520032363, -0.323247237, 0.271573445, -0.317034921, -0.890398916,
          -0.499466441, -0.169076186, -0.319100158, -0.656599154, -0.822538521, -0.578392553, 0.107211253,
          -0.549336867, ], [0.02461886, ]],
        [[-0.289945376, 0.351188773, 0.580722336, -0.487245853, -0.497580308, -0.532082632, -0.653740232, -0.439901831,
          0.335603514, -0.886112854, -0.641641891, -0.503023396, -0.316577238, 0.271573445, -0.317034514, -0.853359096,
          -0.494109257, -0.472978602, -0.309845427, -0.656599154, -0.654998057, -0.578392553, 0.107211253,
          -0.492751316, ], [-0.005314747, ]],
        [[-0.32600562, -0.045370927, 0.705406084, -0.57159421, -0.480332223, -0.363929451, -0.213466198, -0.384858173,
          0.636528809, 0.148381738, -0.028619524, -0.370371484, -0.542010756, -0.782046443, -0.317024739, 0.012613909,
          -0.365247821, 1.162927116, -0.321295078, -0.656599154, 0.043473186, -0.578392553, -0.482450641,
          -0.22489083, ], [0.012299471, ]],
        [[-0.320213149, -0.155334433, 0.740710733, -0.541115628, -0.471607488, -0.341637075, 0.226807835, -0.376070195,
          0.637146726, 0.13955347, 0.275579773, -0.365060405, -0.499456084, -0.783277369, -0.317025003, -0.017737004,
          -0.368735673, 0.707250142, -0.321461398, -0.656599154, 0.34812851, -0.578392553, -0.482450641,
          -0.174388646, ], [0.020541233, ]],
        [[-0.317310016, -0.649963617, 0.738745612, -0.534393027, -0.449582901, -0.302653912, 0.226807835, -0.368195403,
          0.638382559, 0.163648436, 0.236003648, -0.371233815, -0.46790607, -0.783277369, -0.31702123, 0.120786069,
          -0.31898838, 1.369004241, -0.31964406, -0.656599154, 0.806928248, -0.578392553, -0.482450641, -0.128624275, ],
         [0.042559212, ]],
        [[-0.354975735, 0.312270468, -1.473395923, -0.48645435, -0.503201458, -0.414811999, -0.653740232, -0.425609662,
          0.277519371, 0.928446531, -0.161626785, -0.169463267, -0.291959288, 1.421580258, -0.316996987, 0.408314984,
          0.000570326, -0.508056424, -0.320648116, -0.656599154, 0.15339666, -0.578392553, -0.482450641,
          -0.347884035, ], [0.03551263, ]],
        [[-0.348662476, 0.457288308, -1.530127703, -0.494095482, -0.500888265, -0.386891369, -0.653740232, -0.418357075,
          0.322009353, 0.950428175, -0.039623823, -0.169796174, -0.25651429, 1.414328493, -0.316994428, 0.671983316,
          0.034304578, -0.512205403, -0.321196912, -0.656599154, 0.644957826, -0.578392553, -0.482450641,
          -0.304833566, ], [0.054826701, ]],
        [[-0.342100895, 0.422689174, -2.235040224, -0.44347161, 2.341231305, -0.338272663, -0.653740232, -0.404180178,
          0.393687657, 0.973751596, 0.498996554, -0.169515067, -0.234464366, 1.414328493, -0.316985559, 0.808729648,
          0.15122056, -0.40708764, -0.321435394, -0.656599154, 0.959495482, -0.578392553, -0.482450641, -0.161920044, ],
         [0.129696465, ]],
        [[-0.36492761, 0.252072952, -1.483407268, -0.463986744, -0.499117091, -0.695246628, -0.653740232, -0.510862566,
          -0.963874713, -0.460484464, -0.583725268, -0.42414113, -0.509161943, 0.167961513, -0.31703386, -0.676489777,
          -0.48548386, -0.038848965, -0.321319321, -0.656599154, -0.456113631, -0.578392553, -0.482450641,
          -0.528784403, ], [-0.01613185, ]],
        [[-0.358253939, 0.962079369, -1.391418221, -0.491931901, -0.493798565, -0.592366604, -0.653740232, -0.510115345,
          -0.932978892, -0.44738403, -0.466711485, -0.417450111, -0.523069763, 0.164134936, -0.317032216, -0.598752142,
          -0.463815152, 0.010340232, -0.321439293, -0.656599154, -0.369768004, -0.578392553, -0.482450641,
          -0.498647001, ], [-0.012344826, ]],
        [[-0.353759126, -0.218405081, -1.483407268, -0.463986744, 3.303798318, -0.572271556, -0.653740232, -0.50834823,
          -0.858211006, -0.440840051, -0.369120359, -0.414267147, -0.47467037, 0.164134936, -0.317031949, -0.483096769,
          -0.460285878, 0.076727745, -0.320014459, -0.656599154, -0.545553726, -0.578392553, -0.482450641,
          -0.47710626, ], [0.073042603, ]],
        [[-0.382930141, -0.60033949, -0.291849313, -0.537128412, -0.522579387, -0.693280489, -0.653740232, -0.514779215,
          -2.383228725, -0.873126398, -0.904564527, -0.485290771, -0.647047837, -0.331527206, -0.317047299,
          -0.917562147, -0.662637647, 0.187558344, -0.321521586, -0.656599154, -0.906188967, -0.578392553, -0.482450641,
          -0.639290966, ], [-0.008127543, ]],
        [[-0.383035333, -2.280126989, -0.356817858, -0.443790921, -0.520131936, -0.686887463, -0.653740232,
          -0.514608387, -2.339974576, -0.870256705, -0.911436944, -0.484295527, -0.624705797, -0.33398906, -0.317048047,
          -0.88548675, -0.672492251, -0.227707646, -0.321801637, -0.656599154, -0.871011858, -0.578392553, -0.482450641,
          -0.634572602, ], [-0.010193307, ]],
        [[-0.38148073, -1.072787081, -0.342657327, -0.44284015, -0.527193104, -0.67997111, -0.653740232, -0.514088697,
          -2.279418767, -0.852162129, -0.898605622, -0.48150673, -0.626326865, -0.33398906, -0.317047876, -0.821283699,
          -0.670235484, -0.302916663, -0.319922993, -0.656599154, -0.819803411, -0.578392553, -0.482450641,
          -0.637889836, ], [-0.01350384, ]],
        [[-0.380907346, 0.039017392, 0.327500764, -0.520699697, -0.514462319, -0.635005729, -0.653740232, -0.494814873,
          -1.210423364, -0.70172177, -0.834013339, -0.459774211, -0.500843722, -1.046481647, -0.317041779, -0.755439776,
          -0.589864939, 1.751132958, -0.321592574, -0.656599154, -0.842642578, -0.578392553, -0.482450641,
          -0.594291086, ], [0.006536397, ]],
        [[-0.376460818, 0.69653143, 0.36390658, -0.506420054, -0.510686935, -0.627929096, -0.653740232, -0.494374325,
          -1.164079632, -0.69702269, -0.752752986, -0.457481666, -0.490048244, -1.046990073, -0.317041335, -0.650288076,
          -0.584021372, 1.524496638, -0.321627793, -0.656599154, -0.618962483, -0.578392553, -0.482450641,
          -0.574751414, ], [0.003891747, ]],
        [[-0.372805819, -0.002276895, 0.36845344, -0.50663597, 1.711529916, -0.620398581, -0.653740232, -0.493914856,
          -1.1214434, -0.685540546, -0.650959708, -0.470748397, -0.455495329, -1.046990073, -0.31704071, -0.56848484,
          -0.575774683, 1.2912697, -0.318381577, -0.656599154, -0.583386088, -0.578392553, -0.482450641,
          -0.551102944, ], [0.024026811, ]],
        [[-0.340412646, -0.433722275, -1.23014291, -0.496734749, -0.507063861, -0.605685654, -0.653740232, -0.410606088,
          0.219435227, -0.572376857, -0.526932967, -0.348379934, -0.536398756, -0.507817342, -0.317035576, -0.612046344,
          -0.508100656, 1.756752194, -0.321596171, -0.656599154, -0.27393933, -0.578392553, -0.482450641,
          -0.511837637, ], [0.000440583, ]],
        [[-0.336261863, -0.68911698, -1.391256851, -0.513120692, -0.503933026, -0.594469874, -0.653740232, -0.401715111,
          0.224378559, -0.575131222, -0.437956957, -0.34323244, -0.497041405, -0.509797529, -0.317033647, -0.604813964,
          -0.482670754, 1.933157288, -0.321672128, -0.656599154, -0.135786326, -0.578392553, -0.482450641,
          -0.507510312, ], [0.003838465, ]],
        [[-0.332059347, -0.593509857, -1.558338961, -0.496734749, 2.187150714, -0.579329143, -0.653740232, -0.395496295,
          0.228703974, -0.570839497, -0.559959918, -0.341648398, -0.374068653, -0.509797529, -0.317035223, -0.522195517,
          -0.503452693, 1.399970559, -0.320717637, -0.656599154, 0.001428355, -0.578392553, -0.482450641,
          -0.548896656, ], [0.040657021, ]]

    ]
    pat_2=[
        [[-0.181697898, -1.227434631, 0.834371331, 1.515078013, 0.856311828, 2.131455828, 1.98790397, 0.574355091,
          0.9485766, 0.02009298, 1.356685382, 0.711121419, 2.70937006, -0.979583447, -0.306074095, 0.703274857,
          2.554515383, -1.665096991, 2.776985945, 2.121320344, -0.681091406, 2.249304372, 3.055520724, 2.438077177, ],
         [0.990091981, ]],
        [[-0.151693765, -0.279731247, 0.834790023, 1.609929365, 1.01316252, 2.563729007, 1.98790397, 0.582920053,
          0.9485766, 0.032266412, 1.409823638, 0.715254228, 2.978497009, -0.97947641, -0.30583164, 0.544392425,
          2.800643561, -1.657508688, 3.339326837, 2.121320344, -0.698300639, 2.249304372, 3.055520724, 2.803255727, ],
         [1.108831856, ]],
        [[-0.135834915, -0.327118901, 0.834999902, 1.680269183, 1.048019242, 2.723344, 1.547629936, 0.592137879,
          0.9485766, 0.047036394, 1.510211514, 0.721331887, 2.6964186, -0.510359474, -0.305641772, 0.416780632,
          3.033667025, -1.670416842, 3.339326837, 2.121320344, -0.642700044, 2.249304372, 3.055520724, 2.674157709, ],
         [1.086726307, ]],
        [[2.785853514, -2.405858004, 0.834999902, 1.91289956, -0.520601656, -0.689825972, -0.653740232, 3.114165673,
          0.9485766, -1.125558541, -0.851159245, 3.023858052, -0.668004437, -1.232565679, -0.313568492, -1.158007432,
          -0.686700742, -0.94174577, -0.313997529, -0.101015254, -0.971232679, -0.048199379, -0.482450641,
          -0.683250776, ], [0.359510703, ]],
        [[3.277002509, 1.288707251, 0.834999902, 2.807808006, -0.520629483, -0.688498726, -0.653740232, 3.062573513,
          0.9485766, -1.128964404, -0.835699821, 2.9880208, -0.678319428, -1.232565679, -0.313445184, -1.160181326,
          -0.685654448, -0.94712164, -0.313310783, -0.101015254, -0.970374214, -0.048199379, -0.482450641,
          -0.681718953, ], [0.423554174, ]],
        [[3.377702458, 0.213089628, 0.699355061, 2.807808006, -0.306103874, -0.692516917, -0.653740232, 2.873402263,
          0.9485766, -1.12697484, -0.82867281, 2.924682934, -0.667965997, -1.232565679, -0.313042462, -1.164644081,
          -0.684922044, -0.955643265, -0.312473107, -0.101015254, -0.970933215, -0.048199379, -0.482450641,
          -0.681543859, ], [0.405842867, ]],
        [[-0.303560011, 0.061436517, 0.76116156, -0.285702308, -0.429278737, 0.63960957, 0.667081869, -0.324563528,
          0.087201114, 1.35027654, 0.056857035, -0.407332347, 0.957832378, 1.911275081, 2.86910482, 1.670428024,
          -0.145923342, -0.334064351, -0.319312353, 1.565736444, 1.000222668, 1.895842257, 0.107211253, -0.136759746, ],
         [0.563741059, ]],
        [[-0.297489902, 0.272217333, 0.768281813, -0.200666373, -0.422968025, 0.752093491, 0.667081869, -0.230725988,
          0.092144445, 1.441837951, 0.3011862, -0.407838832, 1.10128793, 1.902685352, 3.194440326, 1.589513159,
          -0.095702056, -0.387853503, -0.318410856, 1.565736444, 1.384775148, 1.895842257, 0.107211253, -0.081591239, ],
         [0.634079004, ]],
        [[-0.293339982, -0.467668109, 0.771599114, -0.183876901, -0.42300546, 0.852277473, 0.667081869, -0.221267426,
          0.106974439, 1.561836298, 0.268412222, -0.42024773, 1.173455585, 1.902685352, 3.402441716, 2.105269654,
          -0.099006356, -0.521952768, -0.256015314, 1.565736444, 2.478659455, 1.895842257, 0.107211253, -0.051926877, ],
         [0.761315161, ]],
        [[-0.278714812, 1.127963402, 0.836029134, -0.479239116, -0.459825195, 1.134150811, 1.547629936, -0.221287947,
          0.9485766, 1.866527874, 1.773907121, -0.524597073, -0.077894514, 0.971061022, -0.316923214, 1.736972192,
          0.97305359, -0.387422694, -0.308384535, 1.010152545, 1.923052792, -0.048199379, 0.107211253, 1.12544302, ],
         [0.356620879, ]],
        [[-0.269151803, 1.294091053, 0.836422566, -0.409893477, -0.445246208, 1.28829196, 1.98790397, -0.182311412,
          0.932510774, 1.918399848, 2.19183156, -0.525068616, 0.007595145, 0.965040184, -0.316919469, 1.562391733,
          1.022409836, -0.420075712, -0.312347075, 1.010152545, 2.558097432, -0.048199379, 0.107211253, 1.319137562, ],
         [0.462163959, ]],
        [[-0.26395772, -0.036630574, 0.836749532, -0.406593644, -0.425825785, 1.372740681, 2.428178003, -0.137748203,
          0.93312869, 2.279126982, 2.992924844, -0.51378173, 0.038663634, 0.965040184, -0.316918415, 1.874188838,
          1.036308988, -0.662238848, -0.275623572, 1.010152545, 1.188545975, -0.048199379, 0.107211253, 1.619359491, ],
         [0.467779728, ]],
        [[-0.309279192, 0.585105914, 0.545950416, -0.446083533, -0.50326874, -0.573651369, -0.653740232, -0.452403772,
          0.256510212, -0.908293455, -0.839396029, -0.518690561, -0.379921954, 0.275694374, -0.317035219, -0.885371785,
          -0.503401919, 0.019431446, -0.319530781, -0.656599154, -0.655836558, -0.578392553, 0.107211253,
          -0.573328541, ], [-0.000955047, ]],
        [[-0.293330497, 3.149646125, 0.712704023, -0.479355838, -0.502291814, -0.550078806, -0.653740232, -0.44834969,
          0.291731448, -0.898820771, -0.749239481, -0.520032363, -0.323247237, 0.271573445, -0.317034921, -0.890398916,
          -0.499466441, -0.169076186, -0.319100158, -0.656599154, -0.822538521, -0.578392553, 0.107211253,
          -0.549336867, ], [0.02461886, ]],
        [[-0.289945376, 0.351188773, 0.580722336, -0.487245853, -0.497580308, -0.532082632, -0.653740232, -0.439901831,
          0.335603514, -0.886112854, -0.641641891, -0.503023396, -0.316577238, 0.271573445, -0.317034514, -0.853359096,
          -0.494109257, -0.472978602, -0.309845427, -0.656599154, -0.654998057, -0.578392553, 0.107211253,
          -0.492751316, ], [-0.005314747, ]],
        [[-0.32600562, -0.045370927, 0.705406084, -0.57159421, -0.480332223, -0.363929451, -0.213466198, -0.384858173,
          0.636528809, 0.148381738, -0.028619524, -0.370371484, -0.542010756, -0.782046443, -0.317024739, 0.012613909,
          -0.365247821, 1.162927116, -0.321295078, -0.656599154, 0.043473186, -0.578392553, -0.482450641,
          -0.22489083, ], [0.012299471, ]],
        [[-0.320213149, -0.155334433, 0.740710733, -0.541115628, -0.471607488, -0.341637075, 0.226807835, -0.376070195,
          0.637146726, 0.13955347, 0.275579773, -0.365060405, -0.499456084, -0.783277369, -0.317025003, -0.017737004,
          -0.368735673, 0.707250142, -0.321461398, -0.656599154, 0.34812851, -0.578392553, -0.482450641,
          -0.174388646, ], [0.020541233, ]],
        [[-0.317310016, -0.649963617, 0.738745612, -0.534393027, -0.449582901, -0.302653912, 0.226807835, -0.368195403,
          0.638382559, 0.163648436, 0.236003648, -0.371233815, -0.46790607, -0.783277369, -0.31702123, 0.120786069,
          -0.31898838, 1.369004241, -0.31964406, -0.656599154, 0.806928248, -0.578392553, -0.482450641, -0.128624275, ],
         [0.042559212, ]],
        [[-0.354975735, 0.312270468, -1.473395923, -0.48645435, -0.503201458, -0.414811999, -0.653740232, -0.425609662,
          0.277519371, 0.928446531, -0.161626785, -0.169463267, -0.291959288, 1.421580258, -0.316996987, 0.408314984,
          0.000570326, -0.508056424, -0.320648116, -0.656599154, 0.15339666, -0.578392553, -0.482450641,
          -0.347884035, ], [0.03551263, ]],
        [[-0.348662476, 0.457288308, -1.530127703, -0.494095482, -0.500888265, -0.386891369, -0.653740232, -0.418357075,
          0.322009353, 0.950428175, -0.039623823, -0.169796174, -0.25651429, 1.414328493, -0.316994428, 0.671983316,
          0.034304578, -0.512205403, -0.321196912, -0.656599154, 0.644957826, -0.578392553, -0.482450641,
          -0.304833566, ], [0.054826701, ]],
        [[-0.342100895, 0.422689174, -2.235040224, -0.44347161, 2.341231305, -0.338272663, -0.653740232, -0.404180178,
          0.393687657, 0.973751596, 0.498996554, -0.169515067, -0.234464366, 1.414328493, -0.316985559, 0.808729648,
          0.15122056, -0.40708764, -0.321435394, -0.656599154, 0.959495482, -0.578392553, -0.482450641, -0.161920044, ],
         [0.129696465, ]],
        [[-0.36492761, 0.252072952, -1.483407268, -0.463986744, -0.499117091, -0.695246628, -0.653740232, -0.510862566,
          -0.963874713, -0.460484464, -0.583725268, -0.42414113, -0.509161943, 0.167961513, -0.31703386, -0.676489777,
          -0.48548386, -0.038848965, -0.321319321, -0.656599154, -0.456113631, -0.578392553, -0.482450641,
          -0.528784403, ], [-0.01613185, ]],
        [[-0.358253939, 0.962079369, -1.391418221, -0.491931901, -0.493798565, -0.592366604, -0.653740232, -0.510115345,
          -0.932978892, -0.44738403, -0.466711485, -0.417450111, -0.523069763, 0.164134936, -0.317032216, -0.598752142,
          -0.463815152, 0.010340232, -0.321439293, -0.656599154, -0.369768004, -0.578392553, -0.482450641,
          -0.498647001, ], [-0.012344826, ]],
        [[-0.353759126, -0.218405081, -1.483407268, -0.463986744, 3.303798318, -0.572271556, -0.653740232, -0.50834823,
          -0.858211006, -0.440840051, -0.369120359, -0.414267147, -0.47467037, 0.164134936, -0.317031949, -0.483096769,
          -0.460285878, 0.076727745, -0.320014459, -0.656599154, -0.545553726, -0.578392553, -0.482450641,
          -0.47710626, ], [0.073042603, ]],
        [[-0.382930141, -0.60033949, -0.291849313, -0.537128412, -0.522579387, -0.693280489, -0.653740232, -0.514779215,
          -2.383228725, -0.873126398, -0.904564527, -0.485290771, -0.647047837, -0.331527206, -0.317047299,
          -0.917562147, -0.662637647, 0.187558344, -0.321521586, -0.656599154, -0.906188967, -0.578392553, -0.482450641,
          -0.639290966, ], [-0.008127543, ]],
        [[-0.383035333, -2.280126989, -0.356817858, -0.443790921, -0.520131936, -0.686887463, -0.653740232,
          -0.514608387, -2.339974576, -0.870256705, -0.911436944, -0.484295527, -0.624705797, -0.33398906, -0.317048047,
          -0.88548675, -0.672492251, -0.227707646, -0.321801637, -0.656599154, -0.871011858, -0.578392553, -0.482450641,
          -0.634572602, ], [-0.010193307, ]],
        [[-0.38148073, -1.072787081, -0.342657327, -0.44284015, -0.527193104, -0.67997111, -0.653740232, -0.514088697,
          -2.279418767, -0.852162129, -0.898605622, -0.48150673, -0.626326865, -0.33398906, -0.317047876, -0.821283699,
          -0.670235484, -0.302916663, -0.319922993, -0.656599154, -0.819803411, -0.578392553, -0.482450641,
          -0.637889836, ], [-0.01350384, ]],
        [[-0.380907346, 0.039017392, 0.327500764, -0.520699697, -0.514462319, -0.635005729, -0.653740232, -0.494814873,
          -1.210423364, -0.70172177, -0.834013339, -0.459774211, -0.500843722, -1.046481647, -0.317041779, -0.755439776,
          -0.589864939, 1.751132958, -0.321592574, -0.656599154, -0.842642578, -0.578392553, -0.482450641,
          -0.594291086, ], [0.006536397, ]],
        [[-0.376460818, 0.69653143, 0.36390658, -0.506420054, -0.510686935, -0.627929096, -0.653740232, -0.494374325,
          -1.164079632, -0.69702269, -0.752752986, -0.457481666, -0.490048244, -1.046990073, -0.317041335, -0.650288076,
          -0.584021372, 1.524496638, -0.321627793, -0.656599154, -0.618962483, -0.578392553, -0.482450641,
          -0.574751414, ], [0.003891747, ]],
        [[-0.372805819, -0.002276895, 0.36845344, -0.50663597, 1.711529916, -0.620398581, -0.653740232, -0.493914856,
          -1.1214434, -0.685540546, -0.650959708, -0.470748397, -0.455495329, -1.046990073, -0.31704071, -0.56848484,
          -0.575774683, 1.2912697, -0.318381577, -0.656599154, -0.583386088, -0.578392553, -0.482450641,
          -0.551102944, ], [0.024026811, ]],
        [[-0.340412646, -0.433722275, -1.23014291, -0.496734749, -0.507063861, -0.605685654, -0.653740232, -0.410606088,
          0.219435227, -0.572376857, -0.526932967, -0.348379934, -0.536398756, -0.507817342, -0.317035576, -0.612046344,
          -0.508100656, 1.756752194, -0.321596171, -0.656599154, -0.27393933, -0.578392553, -0.482450641,
          -0.511837637, ], [0.000440583, ]],
        [[-0.336261863, -0.68911698, -1.391256851, -0.513120692, -0.503933026, -0.594469874, -0.653740232, -0.401715111,
          0.224378559, -0.575131222, -0.437956957, -0.34323244, -0.497041405, -0.509797529, -0.317033647, -0.604813964,
          -0.482670754, 1.933157288, -0.321672128, -0.656599154, -0.135786326, -0.578392553, -0.482450641,
          -0.507510312, ], [0.003838465, ]],
        [[-0.332059347, -0.593509857, -1.558338961, -0.496734749, 2.187150714, -0.579329143, -0.653740232, -0.395496295,
          0.228703974, -0.570839497, -0.559959918, -0.341648398, -0.374068653, -0.509797529, -0.317035223, -0.522195517,
          -0.503452693, 1.399970559, -0.320717637, -0.656599154, 0.001428355, -0.578392553, -0.482450641,
          -0.548896656, ], [0.040657021, ]],

    ]

    # create a network with two input, two hidden, and one output nodes
    n = BPNNet(24, 5, 1)
    # train it with some patterns
    n.train(pat)
    # test it
    n.save_weights("demo.weights")

    n.test(pat_2)



if __name__ == '__main__':
    #demo()
    demo_excel(r"G:\projects\周肖树\论文\素材2\bp训练数据.xlsx")

